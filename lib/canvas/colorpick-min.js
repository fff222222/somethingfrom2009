var ColorPicker=function(){var h=Math;var a=function(n,z,x){var m;var u,l,k,y;var c,o,w;if(z==0){x=h.floor(x*255);return{r:x,g:x,b:x}}n/=60;m=h.floor(n);u=n-m;l=x*(1-z);k=x*(1-z*u);y=x*(1-z*(1-u));switch(m){case 0:c=x;o=y;w=l;break;case 1:c=k;o=x;w=l;break;case 2:c=l;o=x;w=y;break;case 3:c=l;o=k;w=x;break;case 4:c=y;o=l;w=x;break;default:c=x;o=l;w=k;break}return{r:c*255,g:o*255,b:w*255}};var d=function(c){return document.getElementById(c)};var j=function(l,k){for(var c in k){l[c]=k[c]}};var e=function(c){if(document.documentElement.getBoundingClientRect){var k=c.getBoundingClientRect();return{x:k.left+document.body.scrollLeft,y:k.top+document.body.scrollTop}}else{var m=[c.offsetLeft,c.offsetTop];var l=c.offsetParent;if(l!=c){while(l){m[0]+=l.offsetLeft+parseInt(l.style.borderLeftWidth)||0;m[1]+=l.offsetTop+parseInt(l.style.borderTopWidth)||0;l=l.offsetParent}}return{x:m[0],y:m[1]}}};var g=function(l,p,o){var m=document.createElement(l);if(p!=undefined){if(p.i){m.innerHTML=p.i}if(p.c){m.className=p.c}if(p.a){var c=p.a;for(var k in c){m[k]=c[k]}}if(p.s){j(m.style,p.s)}}if(o==undefined){return m}for(var k=0,q=o.length;k<q;k++){m.appendChild(o[k])}return m};var b=function(c){return"RGB("+h.round(c.r)+","+h.round(c.g)+","+h.round(c.b)+")"};var i=function(l,k,c){if(document.all){l.attachEvent("on"+k,c)}else{l.addEventListener(k,c,false)}};var f=function(){var c=this;c.el=null;c.el_xy=null;c.el_disc=null;c.el_light=null;c.h=0;c.s=0;c.l=0;c.lightItems=[];c.lastItem=null;c.color="#fff";c.onchangeCall=[];c.onpickCall=[]};f.prototype={init:function(){this.createHtml();this.bindEvent()},createHtml:function(){this.el=g("div",{c:"CP-con"},[g("div",{c:"CP-wrap"},[g("div",{c:"CP-hd",i:"\u93b7\u6350\u58ca\u9363\ufffd"}),g("div",{c:"CP-bd"},[this.el_disc=g("div",{c:"CP-disc"},[g("img",{a:{src:"http://img04.taobaocdn.com/tps/i4/T15ZeeXoxbXXXXXXXX-160-160.png",width:"160",height:"160"}}),this.el_xy=g("div",{c:"CP-xy"})]),this.el_light=g("div",{c:"CP-light"},this.lightItems=(function(){for(var k=0,c=[];k<40;k++){c.push(g("div",{c:"CP-lightItem",s:{background:b(a(0,0,k/40))}}))}return c})()),g("input",{c:"CP-value",a:{type:"input"}}),g("button",{c:"CP-ok",a:{type:"button"}}),g("div",{c:"CP-power"}),])])])},bindEvent:function(){var c=this;i(this.el_disc,"mousemove",function(k){var k=window.event||k});i(this.el_disc,"click",function(m){var m=window.event||m;var k=m.pageX-e(this).x,o=m.pageY-e(this).y;c.el_xy.style.left=(k-3)+"px";c.el_xy.style.top=(o-3)+"px";var l=h.sqrt((k-80)*(k-80)+(o-80)*(o-80));if(l<80){var n=(h.atan2((80-o),(80-k)))*180/h.PI;n<0&&(n+=360);c.h=n;c.s=l/80;c.updateL()}});i(this.el_light,"click",function(l){var l=window.event||l;var k=l.target;if(k.className=="CP-lightItem"){c.lastItem&&(c.lastItem.style.borderBottom="none");k.style.borderBottom="1px solid #fff";c.l=(e(k).y-e(k.parentNode).y)/163;c.color=b(a(c.h,c.s,c.l));c.pick();c.lastItem=k}})},updateL:function(){var c=this.lightItems;for(var k=0;k<c.length;k++){c[k].style.background=b(a(this.h,this.s,k/40))}},appendTo:function(c){c.appendChild(this.el)},onchange:function(c){this.onchangeCall.push(c)},onpick:function(c){this.onpickCall.push(c)},change:function(){for(var c=0;c<this.onchangeCall.length;c++){this.onchangeCall[c].call(this,this.color)}},pick:function(){for(var c=0;c<this.onpickCall.length;c++){this.onpickCall[c].call(this,this.color)}}};return f}();var picker=new ColorPicker();picker.init();picker.appendTo(document.body);picker.onpick(function(a){document.body.style.background=a});
