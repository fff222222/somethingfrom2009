MJ.add("Dom",function(){var b=MJ.tool,a=MJ.Vector;var c=function(){return{body:b.body,createElement:function(f,j,h){var g=document.createElement(f);if(j!=undefined){if(j.p){(j.p).appendChild(g)}if(j.i){g.innerHTML=j.i}if(j.c){g.className=j.c}if(j.a){var d=j.a;for(var e in d){g[e]=d[e]}}if(j.s){MJ.Dom.mixinStyle(g,j.s)}}if(h==undefined){return g}if(h.length==undefined){g.appendChild(h)}else{for(var e=0,k=h.length;e<k;e++){g.appendChild(h[e])}}return g},str2ele:function(){},get:function(d){return MJ(d).getEle()[0]},query:function(d){return MJ(d).getEle()},getById:function(d){return document.getElementById(d)},getByClass:function(k,e,f){var e=e||"*",f=f||document,d=f.getElementsByTagName(e),l=[];for(var h=0,g=d.length;h<g;h++){if(MJ.Dom.hasClass(k,d[h].className)){l.push(d[h])}}return l},getByTag:function(g,f){var e=g||"*",f=f||document,d=f.getElementsByTagName(e);return d},insertAfter:function(f,e){var d=e.parentNode;if(d.lastChild==e){d.appendChild(f)}else{d.insertBefore(f,e.nextSibling)}},replace:function(f,e){var d=e.parentNode;d.insertBefore(f,e);d.removeChild(e);return true},getCursorPos:function(i,g){var f=document.createElement("div"),j=M.dom,h=M.Event,d=document.createElement("span");f.contentEditable=true;document.body.appendChild(f);f.appendChild(d);j.mixinStyle(f,j.getCSSes(i,["width","height","fontSize","lineHeight","fontSize","border","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","borderTop","fontFamily","overflowX","overflowY","wordBreak","wordSpacing","wordWrap"]));j.mixinStyle(d,j.getCSSes(i,["fontSize","lineHeight","fontSize","fontFamily","fontStyle","fontVariant","fontWeight","letterSpacing"]));j.mixinStyle(f,{visibility:"hidden"});j.setXY(f,j.getXY(i));var e=document.createElement("span");e.innerHTML="";f.appendChild(e);h.on(i,"input",function(){d.innerHTML=this.value;var k=j.getXY(e);g.call(window,k)})},hasClass:function(g,f){if(typeof(g)!="string"){return this.hasClass(f,g.className)}var e=f.replace(/\s{2,}/g," ").split(" ");for(var d=0;d<e.length;d++){if(e[d]==g){return true}}return false},addClass:function(f,e){if(b.isArray(e)){for(var d=0,h=e.length;d<h;d++){this.addClass(f,e[d])}return}var g=f.className;g=(" "+g+" ").replace(/\s{2,}/g," ");if(g.indexOf(" "+e+" ")==-1){g+=" "+e}f.className=g},removeClass:function(f,e){if(b.isArray(e)){for(var d=0,h=e.length;d<h;d++){this.removeClass(f,e[d])}return}var g=f.className;g=(" "+g+" ").replace(/\s{2,}/g," ");g=g.replace(" "+e+" "," ");f.className=g},getAllClass:function(d){return d.className.split(/\s{1,}/)},setAttrs:function(f,e){for(var d in e){f.setAttribute(d,e[d])}},getAttrJson:function(j,d){var e=j.getAttribute(d),h={},g;for(var f=0,k=(e=e.split(";")).length;f<k;f++){g=e[f].split(":");h[g[0]]=g[1]}return h},mixStyle:function(f,e){if(f.length){for(var d=0;d<f.length;d++){this.mixin(f[d].style,e)}return}this.mixin(f.style,e)},getCss:function(e,d,g){if(g===undefined){g=true}var f=b.isIE?e.currentStyle[d]:window.getComputedStyle(e,null)[d];if(f!="auto"){return g?f:f.replace("px","")*1}return false},css:function(f,d,e){if(e===undefined){return this._getCssValue(f,d)}else{return this._setCssValue(f,d,e)}},_setCssValue:function(f,d,e){if(d!="opacity"){f.style[d]=e+"px"}else{b.isIE?f.style.filter="alpha(opacity="+e*100+")":f.style.opacity=e+""}},_getCssValue:function(e,d){if(d!="opacity"){return e.style[d].replace("px","")}else{return b.isIE?e.filters.alpha.opacity/100:e.style.opacity}},getDocumentWidth:function(){return this.body.clientWidth},getDocumentHeight:function(){return this.body.clientHeight},getScrollXY:function(){var d=document.documentElement.scrollLeft||document.body.scrollLeft;var e=document.documentElement.scrollTop||document.body.scrollTop;return new MJ.Vector(d,e)},place:function(e,d){if(d===undefined){return this._getXY(e)}else{return this._setXY(e,d)}},_setXY:function(e,d){this.mixinStyle(e,{position:"absolute",left:d.x+"px",top:d.y+"px"});return new MJ.Vector(d.x,d.y)},_getXY:function(d){if(document.documentElement.getBoundingClientRect){var e=d.getBoundingClientRect();return new MJ.Vector(e.left+this.getScrollXY().x,e.top+this.getScrollXY().y)}else{var g=[d.offsetLeft,d.offsetTop];var f=d.offsetParent;if(f!=d){while(f){g[0]+=f.offsetLeft+parseInt(getStyle(f,"borderLeftWidth"))||0;g[1]+=f.offsetTop+parseInt(getStyle(f,"borderTopWidth"))||0;f=f.offsetParent}}return new MJ.Vector(g[0],g[1])}},getOffsetSize:function(d){return new MJ.Vector(d.offsetWidth,d.offsetHeight)},getMousePos:function(d){if(d.pageX||d.pageY){return new MJ.Vector(d.pageX,d.pageY)}return new MJ.Vector(d.clientX+this._bodyValue("scrollLeft")-this._bodyValue("clientLeft"),d.clientY+this._bodyValue("scrollTop")-this._bodyValue("clientTop"))},setInnerHTML:function(e,d){if(!e||typeof d!=="string"){return null}(function(j){var g=j.attributes,h,f,m,k;if(g){f=g.length;for(h=0;h<f;h+=1){m=g[h].name;if(typeof j[m]==="function"){j[m]=null}}}g=j.childNodes;if(g){f=g.length;for(h=0;h<f;h+=1){k=j.childNodes[h];arguments.callee(k);MJ.Event.clearListener(k)}}})(e);e.innerHTML=d.replace(/<script[^>]*>[\S\s]*?<\/script[^>]*>/ig,"");return e.firstChild}}}();return c},["Vector",{module:"Event",methods:["on"]}]);MJ.dom=MJ.Dom;MJ.add("Event",function(){var b=MJ.tool,a=function(){this._withinElement=function(c){return function(f){var d=f.relatedTarget;while(d&&d!=this){try{d=d.parentNode}catch(f){break}}if(d!=this){c.call(this,f)}}};return{types:["abort","blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","reset","resize","select","submit","unload"],addListener:function(h,e,f,k,g){if(!h){return}if(h.length&&h.length>1){for(var c=0,j=h.length;c<j;c++){this.addListener(h[c],e,f,k,g)}return}if(typeof(k)=="string"){if(/^\$\_.*/.test(k)==false){b.trace("event.addlistener\u6d5c\u5b29\u6b22\u93cd\u56ea\u7611\u7ed7\ufe40\u7c32\u7487\u30e7\u6564$_\u5bee\ufffd\u6fb6\ufffd")}else{}}else{if(/^\$\_.*/.test(k)==false){if(g){b.trace("event.addlistener\u93c8\u590a\ue63f\u6d63\u6b11\u6b91\u9359\u509b\u669f\u93b4\u682c\ufffd\u546c\u7c28\u6d60\u8235\u7223\u7487\u55d9\ue0c1\u6434\u65c7\ue1da\u9422\ufffd$_\u5bee\ufffd\u6fb6\ufffd");return}var g=k||"";k="_undefined"}}if(!h.events){h.events=[]}var d=null;if(k=="_undefined"){d=h.events[h.events.length]=function(i){f.call(h,i,g)}}else{d=h.events[k]=function(i){f.call(h,i,g)}}if(b.isIE){h.attachEvent("on"+e,d)}else{if(e==="mouseenter"){h.addEventListener("mouseover",this._withinElement(d),false)}else{if(e==="mouseleave"){h.addEventListener("mouseout",this._withinElement(d),false)}else{h.addEventListener(e,d,false)}}}},removeListener:function(d,c,g){try{if(b.isIE){d.detachEvent("on"+c,d.events[g])}else{if(c==="mouseenter"){d.removeEventListener("mouseover",this._withinElement(d.events[g]),false)}else{if(c==="mouseleave"){d.removeEventListener("mouseout",this._withinElement(d.events[g]),false)}else{d.removeEventListener(c,d.events[g],false)}}}}catch(f){}},clearListener:function(d){if(d.events){for(var c in d.events){d.events=null}}d.events.length=0;d.events=null},on:function(f,c,d,g,e){this.addListener(f,c,d,g,e)},off:function(d,c,e){this.removeListener(d,c,e)},stopPropagation:function(c){if(c&&c.stopPropagation){c.stopPropagation()}else{window.event.cancelBubble=true}return false},stop:function(c){this.stopPropagation(c)},preventDefault:function(c){if(c&&c.preventDefault){c.preventDefault()}else{window.event.returnValue=false}return false}}}();return a});MJ.add("CustomEvent",function(){var a=function(b,c){this.handle=c;this.type=b;this.init(b)};a.NEEDED=["init"];a.prototype={init:function(b){if(this.handle.EVENT_LIST==undefined){this.handle.EVENT_LIST=[]}this.handle.EVENT_LIST[b]=[]},fire:function(d){var c=this.handle.EVENT_LIST[this.type];for(var b=0,e=c.length;b<e;b++){c[b].func.call(this.handle,{event_param:c[b].param,fire_param:d})}}};return a});MJ.add("Data",function(){var a=function(b){this.data=b||0;this.events={get:new MJ.CustomEvent("get",this),set:new MJ.CustomEvent("set",this)}};a.prototype={get:function(){return this.data},set:function(b){this.data=b;this.events.set.fire(b)},addListener:function(c,d,e){for(var b in this.EVENT_LIST){if(b==c){this.EVENT_LIST[b].push({func:d,param:e});return}}},on:function(b,c,d){this.addListener(b,c,d)}};return a});
