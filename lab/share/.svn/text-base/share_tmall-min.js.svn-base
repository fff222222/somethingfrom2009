(function(){KISSY.Share=function(){if(typeof(KISSY)=="undefined"){return}var g=KISSY,a=g.DOM,r=g.Event,n={copy:["MSN/QQ","-248","",""],jianghu:["\u6dd8\u6c5f\u6e56","-4","http://share.jianghu.taobao.com/share/addShare.htm?url={U}","width=550,height=400"],sina:["\u65b0\u6d6a\u5fae\u535a","-41","http://v.t.sina.com.cn/share/share.php?title={T}&url={U}","width=620,height=450"],qzone:["QQ\u7a7a\u95f4","-60","http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={U}","width=900,height=760"],renren:["\u4eba\u4eba\u7f51","-79","http://share.renren.com/share/buttonshare.do?link={U}","width=570,height=450"],kaixin:["\u5f00\u5fc3\u7f51","-22","http://www.kaixin001.com/repaste/bshare.php?rtitle={T}&URL={U}","width=800,height=550"],douban:["\u8c46\u74e3","-96","http://www.douban.com/recommend/?title={T}&url={U}&v=1&sel=","scrollbars=yes,width=450,height=355"],wangyi:["\u7f51\u6613\u5fae\u535a","-211","http://t.163.com/article/user/checkLogin.do?&info={T} {U}",""],tengxun:["\u817e\u8baf\u5fae\u535a","-461","http://v.t.qq.com/share/share.php?title={T}&url=={U}",""],souhu:["\u641c\u72d0\u5fae\u535a","-192","http://t.sohu.com/third/post.jsp?url={T}&title={U}",""]},l=".tmall-share{width:300px;background:#fff;border:1px solid #9A0C1A;-moz-box-shadow:#DAB8BB 0 0 3px;-webkit-box-shadow:0 0 3px #DAB8BB;position:absolute;top:400px;left:500px;display:none;}.tmall-share-inner{background:#f7f7f7;height:100%;position:relative;}.tmall-share-hd{border-bottom:1px solid #ddd;height:25px;padding-left:5px;line-height:25px;position:relative;font-size:12px;}.tmall-share-hd h2{font-weight:bold;font-size:12px;}.tmall-share-close{position:absolute;right:5px;top:0;height:25px;width:30px;line-height:25px;text-align:center;cursor:pointer;display:block;}.tmall-share-p{background:url(http://img02.taobaocdn.com/tps/i2/T1I9XQXkpkXXXXXXXX-67-16.png) no-repeat;width:11px;height:11px;position:absolute;}.tmall-share-p.pos-1{background-position:-4px 0;top:-11px;}.tmall-share-p.pos-2{background-position:-20px -1px;right:-11px;}.tmall-share-p.pos-3{background-position:-36px -1px;bottom:-9px;}.tmall-share-p.pos-4{background-position:-53px -1px;left:-10px;}.tmall-share-p.pos-1.s-1,.tmall-share-p.pos-3.s-1{left:10px;}.tmall-share-p.pos-1.s-2,.tmall-share-p.pos-3.s-2{right:10px;}.tmall-share-p.pos-2.s-1,.tmall-share-p.pos-4.s-1{top:10px;}.tmall-share-p.pos-2.s-2,.tmall-share-p.pos-4.s-2{bottom:10px;}.tmall-share-bd{padding:5px 5px 15px 10px;}.tmall-share-list li{float:left;display:inline;margin-top:5px;height:20px;margin-left:3px;}.tmall-share-list.show-all li{width:80px;}.tmall-share-list li a{cursor:pointer;padding-left:19px;display:block;height:16px;color:#666;background:url(http://img03.taobaocdn.com/tps/i3/T1VRXQXjtDXXXXXXXX-16-500.gif) no-repeat;line-height:16px;}.tmall-share-list.show-icon li{width:20px;overflow:hidden;text-indent:-100px;}",b={pos:1,hasText:true,triggerType:"click",anim:false,triggerClass:".J_Share_Trigger",width:350,height:120,icon_width:260,icon_height:65,title:document.title,url:window.location.href},o='<div class="tmall-share-inner"><div class="tmall-share-hd"><h2>\u5206\u4eab\u5230:</h2><a class="tmall-share-close">\u5173\u95ed</a></div><div class="tmall-share-bd"><ul class="tmall-share-list  clearfix"></ul></div></div><div class="tmall-share-p pos-1 s-1"></div>',f,m,j,d,q,c,p,e=false,i=true,k=function(h){var t=a.get(h);if(t){if(t.nodeName=="AREA"){var s=a.attr(t,"coords").split(",");t=a.filter("img",function(v){return a.attr(v,"usemap")=="#"+a.attr(t.parentNode,"name")})[0];var u=a.offset(t);return{x1:u.left+s[0]*1,y1:u.top+s[1]*1,x2:u.left+s[2]*1,y2:u.top+s[3]*1}}else{var u=a.offset(t);return{x1:u.left,y1:u.top,x2:u.left+a.width(t),y2:u.top+a.height(t)}}}return{x1:0,x2:0,y1:0,y2:0}};return{init:function(){this.triggerDom=a.get(b.triggerClass);f=null;if(typeof(f)=="undefined"){return}var h=this.getConfig();h.hasText&&(h.hasText=(h.hasText=="1")?true:false);h.anim&&(h.anim=(h.anim=="1")?true:false);g.mix(b,h);p=this;this.bindEvent()},getConfig:function(){var s=a.attr(this.triggerDom,"data:shareConfig")||"",h={},t;s=s.split(";");g.each(s,function(u){t=u.split(":");h[t[0]]=t[1]});return h},bindEvent:function(){var s=this.triggerDom,h=b.triggerType;(h=="click")&&r.on(s,"click",this.show);(h=="hover")&&r.on(s,"mouseenter",this.show)},createHtml:function(){var h;a.addStyleSheet(l);(h=a.create("<div>")).className="tmall-share";a.css(h,{width:(b.hasText?b.width:b.icon_width)+"px",height:(b.hasText?b.height:b.icon_height)+"px"});h.id="J_Tmall_Share";h.innerHTML=o;document.body.appendChild(f=h);a.addClass(".tmall-share-list",b.hasText?"show-all":"show-icon");this.createItems();r.on(".tmall-share-close","click",this.hide);r.on(a.query("a",a.get(".tmall-share-list")),"click",function(){var u=this.className,t=n[u][0],s=n[u][2].replace("{U}",b.url).replace("{T}",b.title),v=n[u][3],w=window;if(u!="copy"){w.open(s,t,v+",scrollbars=no,status=no,modal=yes")}else{if(w.clipboardData){if(w.clipboardData.setData("Text",b.title+" \n "+b.url)){alert("\u590d\u5236\u6210\u529f,\u8bf7\u7c98\u8d34\u5230\u4f60\u7684QQ/MSN\u4e0a\u63a8\u8350\u7ed9\u4f60\u7684\u597d\u53cb\uff01")}}else{w.prompt("\u60a8\u4f7f\u7528\u7684\u662f\u975eie\u6d4f\u89c8\u5668,\u4e0d\u652f\u6301\u76f4\u63a5\u590d\u5236\u529f\u80fd,\u8bf7\u7528\u53f3\u952e\u590d\u5236\u4e0b\u9762\u7684\u5185\u5bb9\u5230QQ\u6216\u8005MSN\u5185\u8ddf\u597d\u53cb\u5206\u4eab!",b.title+"  "+b.url)}}})},show:function(h){h.halt();if(e){return}e=true;if(i){p.createHtml();i=false}p.initTrigger();if(b.anim){a.css(f,{opacity:0,display:"block"});var s=0;setTimeout(function(){a.css(f,"opacity",(s+=0.05));if(a.css(f,"opacity")<1){setTimeout(arguments.callee,10)}},10)}else{f.style.display="block"}},hide:function(h){h.halt();e=false;if(b.anim){var s=a.css(f,"opacity");setTimeout(function(){a.css(f,"opacity",(s-=0.05));if(a.css(f,"opacity")>0){setTimeout(arguments.callee,10)}else{f.style.display="none"}},10)}else{f.style.display="none"}},initTrigger:function(){m=a.viewportWidth();j=a.viewportHeight();d={x:(b.hasText?b.width:b.icon_width),y:(b.hasText?b.height:b.icon_height)};q=k(b.triggerClass);var t;this.countPopupPos(b.pos);reMap={1:[2,6,5],2:[1,5,6],3:[8,4,7],4:[7,3,8],5:[6,2,1],6:[5,1,2],7:[4,8,3],8:[3,7,4]};t=b.pos;var s=c.x<a.scrollLeft()||c.x+d.x*1-a.scrollLeft()>m-a.scrollLeft();var h=c.y<a.scrollTop()||c.y+d.y*1-a.scrollTop()>j-a.scrollTop();if(s&&h){t=reMap[b.pos][2]}else{if(s){t=reMap[b.pos][0]}else{if(h){t=reMap[b.pos][1]}}}this.countPopupPos(t);a.css(f,{left:c.x+"px",top:c.y+"px"})},countPopupPos:function(h){h=h*1;c={},cache=[];switch(h){case 1:cache=[q.x1,q.y1-d.y-10];break;case 2:cache=[q.x2-d.x,q.y1-d.y-10];break;case 3:cache=[q.x2+10,q.y1];break;case 4:cache=[q.x2+10,q.y2-d.y];break;case 5:cache=[q.x2-d.x,q.y2+10];break;case 6:cache=[q.x1,q.y2+10];break;case 7:cache=[q.x1-d.x-10,q.y2-d.y];break;case 8:cache=[q.x1-d.x-10,q.y1];break;default:cache=[q.x1,q.y2+10];break}c={x:cache[0],y:cache[1]};this.setPointer(h);return c},setPointer:function(t){var h=a.get(".tmall-share-p");t=t*1;var s={1:3,2:4,3:1,4:2};h.className="tmall-share-p pos-"+s[Math.ceil(t/2)]+" s-"+(((280%t==0)&&(t!=1)&&(t!=8))?"2":"1")},createItems:function(){for(var t in n){var h=a.create("<li>");var s=a.create("<a>",{title:n[t][0]});s.className=t;h.appendChild(s);a.html(s,n[t][0]);a.get(".tmall-share-list").appendChild(h);s.style.backgroundPosition="0 "+n[t][1]+"px"}},die:function(){f&&document.body.removeChild(f);f=null;m=0;j=0;d=null;q=null;c=null;e=false;i=true;r.remove(".J_Share_Trigger","click");r.remove(".J_Share_Trigger","mouseenter")}}}();window.onload=function(){KISSY.Share.init()}})();
